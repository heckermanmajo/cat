<html>
    <head>
        <script src="entity.js"></script>
        <script src="/entities/config_entry.js"></script>
        <script src="/lib.js"></script>
        <link href="/default.css" type="text/css" rel="stylesheet">
        <script>
            window.onload = async () => {
               lib.setupThemeOnLoad().then();
               // Redirect wenn bereits Community gesetzt
               const slug = await ConfigEntry.get('current_community');
               if (slug) {
                   window.location.href = '/members.html';
               }
            }
        </script>
        <title>Cat</title>
    </head>
    <body>

        <header style="height: 30px">

            <nav style="float: right">
                <select id="themeSelection" onchange="lib.setTheme(this.value).then()">
                    <option value="blue"> Blue </option>
                    <option value="red"> Red </option>
                    <option value="purple"> Purple </option>
                    <option value="orange"> Orange </option>
                    <option value="pink"> Pink </option>
                    <option value="cyan"> Cyan </option>
                    <option value="gold"> Gold </option>
                </select>
            </nav>

        </header>
    
        <main>
            <article style="margin-left: 20%; margin-right: 20%; text-align: center;">
                <h1>CAT KNOWS</h1>
                <input placeholder="Access Key">
                <br><br>
                <input id="communitySlugInput" placeholder="Community Slug (z.B. skool/community)">
                <br>
                <small style="margin-top: 5px;margin-bottom: 5px;">Der Slug ist der Teil nach skool.com/ in der URL deiner Community</small>
                <br><br>
                <button onclick="startApp()">
                    Start
                </button>
                <br>
                <small style="margin-top: 5px;margin-bottom: 5px;">We sent you an access key in your Skool-Mesages ... </small>
                <br>
            </article>
        </main>
        <script>
            async function startApp() {
                const slug = document.getElementById('communitySlugInput').value.trim();
                if (!slug) {
                    alert('Bitte gib einen Community Slug ein');
                    return;
                }
                // Community in Config speichern
                await ConfigEntry.set('current_community', slug);
                // Zur communities-Liste hinzuf√ºgen falls noch nicht vorhanden
                let communities = await ConfigEntry.get('communities');
                communities = communities ? JSON.parse(communities) : [];
                if (!communities.includes(slug)) {
                    communities.push(slug);
                    await ConfigEntry.set('communities', JSON.stringify(communities));
                }
                window.location.href = '/members.html';
            }
        </script>
    </body>
</html>